{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _asyncStorage = _interopRequireDefault(require(\"@react-native-community/async-storage\"));\n\nvar _config = require(\"../firebase/config.js\");\n\nvar _View = _interopRequireDefault(require(\"react-native-web/dist/exports/View\"));\n\nvar _TouchableOpacity = _interopRequireDefault(require(\"react-native-web/dist/exports/TouchableOpacity\"));\n\nvar _TouchableWithoutFeedback = _interopRequireDefault(require(\"react-native-web/dist/exports/TouchableWithoutFeedback\"));\n\nvar _StyleSheet = _interopRequireDefault(require(\"react-native-web/dist/exports/StyleSheet\"));\n\nvar _ImageBackground = _interopRequireDefault(require(\"react-native-web/dist/exports/ImageBackground\"));\n\nvar _reactNativeElements = require(\"react-native-elements\");\n\nvar _Spacer = _interopRequireDefault(require(\"./Spacer\"));\n\nvar _navigationRef = require(\"../navigationRef\");\n\nvar _FontAwesome = _interopRequireDefault(require(\"@expo/vector-icons/FontAwesome\"));\n\nvar _ProfileIcon = _interopRequireDefault(require(\"./ProfileIcon\"));\n\nvar _reactNavigation = require(\"react-navigation\");\n\nvar _this = this,\n    _jsxFileName = \"/Users/rithikpothuganti/Telescope-app/Telescope/src/components/DiscussionFeedCard.js\";\n\nvar DiscussionFeedView = function DiscussionFeedView(_ref) {\n  var title = _ref.title,\n      description = _ref.description,\n      data = _ref.data,\n      id = _ref.id,\n      not_touchable = _ref.not_touchable,\n      num_comments = _ref.num_comments,\n      padding = _ref.padding;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      upvoted = _useState2[0],\n      setUpvoted = _useState2[1];\n\n  var _useState3 = (0, _react.useState)([]),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      upvotes = _useState4[0],\n      setUpvotes = _useState4[1];\n\n  var padding_ = padding ? 16 : 0;\n\n  function fetchUid() {\n    var uid, discussionsRef;\n    return _regenerator.default.async(function fetchUid$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regenerator.default.awrap(_asyncStorage.default.getItem(\"token\"));\n\n          case 2:\n            uid = _context.sent;\n            discussionsRef = _config.firebase.firestore().collection(\"discussions\");\n            discussionsRef.doc(id).get().then(function (doc) {\n              var data = doc.data();\n              setUpvoted(data.upvotes.includes(uid));\n              setUpvotes(data.upvotes);\n            }).catch(function (error) {\n              return console.log(error.message);\n            });\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  (0, _react.useEffect)(function () {\n    fetchUid();\n    return function () {\n      null;\n    };\n  }, []);\n  return _react.default.createElement(_TouchableOpacity.default, {\n    onPress: function onPress() {\n      (0, _navigationRef.navigate)(\"DiscussionView\", {\n        data: data,\n        upvoted: upvoted,\n        setUpvoted: setUpvoted,\n        upvotes: upvotes,\n        setUpvotes: setUpvotes,\n        editVote: editVote\n      });\n    },\n    disabled: not_touchable,\n    style: {\n      paddingLeft: padding_,\n      paddingRight: padding_\n    },\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 5\n    }\n  }, _react.default.createElement(_reactNavigation.NavigationEvents, {\n    onWillFocus: function onWillFocus(payload) {\n      return fetchUid();\n    },\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }\n  }), _react.default.createElement(_View.default, {\n    style: styles.container,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }\n  }, _react.default.createElement(_View.default, {\n    style: styles.profilecontainer,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_ProfileIcon.default, {\n    uid: data.discussion_uid,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 11\n    }\n  })), _react.default.createElement(_View.default, {\n    style: styles.textContainer,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_reactNativeElements.Text, {\n    style: styles.title,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 11\n    }\n  }, title), _react.default.createElement(_reactNativeElements.Text, {\n    style: styles.description,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 11\n    }\n  }, description), _react.default.createElement(_View.default, {\n    style: styles.bottomRow,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 11\n    }\n  }, _react.default.createElement(_TouchableWithoutFeedback.default, {\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 13\n    }\n  }, _react.default.createElement(_TouchableOpacity.default, {\n    onPress: function onPress() {\n      return editVote(upvotes, id, setUpvoted);\n    },\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 15\n    }\n  }, _react.default.createElement(_View.default, {\n    style: styles.upvoteView,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 17\n    }\n  }, _react.default.createElement(_FontAwesome.default, {\n    name: upvoted ? \"heart\" : \"heart-o\",\n    size: 20,\n    color: upvoted ? \"#FFD770\" : \"#999999\",\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 19\n    }\n  }), _react.default.createElement(_reactNativeElements.Text, {\n    style: styles.text,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 19\n    }\n  }, upvotes.length)))), _react.default.createElement(_View.default, {\n    style: styles.upvoteView,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, _react.default.createElement(_FontAwesome.default, {\n    name: \"comment-o\",\n    size: 20,\n    color: \"#999999\",\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 15\n    }\n  }), _react.default.createElement(_reactNativeElements.Text, {\n    style: styles.text,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 15\n    }\n  }, num_comments))))));\n};\n\nvar editVote = function editVote(upvotes, id, setUpvoted) {\n  var uid, discussionsRef, new_upvotes;\n  return _regenerator.default.async(function editVote$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regenerator.default.awrap(_asyncStorage.default.getItem(\"token\"));\n\n        case 2:\n          uid = _context2.sent;\n          discussionsRef = _config.firebase.firestore().collection(\"discussions\");\n          console.log(\"hi\");\n          new_upvotes = upvotes;\n\n          if (!upvotes.includes(uid)) {\n            _context2.next = 13;\n            break;\n          }\n\n          new_upvotes.splice(new_upvotes.indexOf(uid), 1);\n          _context2.next = 10;\n          return _regenerator.default.awrap(discussionsRef.doc(id).update({\n            upvotes: new_upvotes,\n            num_upvotes: upvotes.length\n          }));\n\n        case 10:\n          setUpvoted(false);\n          _context2.next = 17;\n          break;\n\n        case 13:\n          new_upvotes.push(uid);\n          _context2.next = 16;\n          return _regenerator.default.awrap(discussionsRef.doc(id).update({\n            upvotes: new_upvotes,\n            num_upvotes: upvotes.length\n          }));\n\n        case 16:\n          setUpvoted(true);\n\n        case 17:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nvar styles = _StyleSheet.default.create({\n  container: {\n    backgroundColor: \"white\",\n    flexDirection: \"row\",\n    width: \"100%\",\n    padding: 0,\n    borderBottomWidth: 2,\n    borderBottomColor: \"#E5E5E5\",\n    paddingBottom: 16,\n    paddingTop: 16\n  },\n  profilecontainer: {\n    flexDirection: \"column\",\n    alignContent: \"flex-start\",\n    paddingRight: 8\n  },\n  horizontalContainer: {\n    flexDirection: \"row-reverse\",\n    alignItems: \"center\",\n    height: \"100%\"\n  },\n  name: {\n    fontWeight: \"bold\"\n  },\n  text: {\n    color: \"#999999\",\n    fontFamily: \"Raleway\",\n    paddingLeft: 4,\n    fontSize: 11\n  },\n  upvoteView: {\n    flexDirection: \"row\",\n    alignItems: \"flex-end\",\n    justifyContent: \"flex-start\",\n    paddingTop: 8,\n    borderRadius: 8,\n    marginRight: 8\n  },\n  title: {\n    fontFamily: \"Raleway-Bold\",\n    fontSize: 13,\n    paddingTop: 6,\n    paddingBottom: 8\n  },\n  description: {\n    fontFamily: \"Raleway-Regular\",\n    fontSize: 13,\n    color: \"#86878B\"\n  },\n  bottomRow: {\n    padding: 0,\n    flexDirection: \"row\"\n  },\n  textContainer: {\n    flex: 1\n  }\n});\n\nvar _default = DiscussionFeedView;\nexports.default = _default;","map":{"version":3,"sources":["/Users/rithikpothuganti/Telescope-app/Telescope/src/components/DiscussionFeedCard.js"],"names":["DiscussionFeedView","title","description","data","id","not_touchable","num_comments","padding","upvoted","setUpvoted","upvotes","setUpvotes","padding_","fetchUid","AsyncStorage","getItem","uid","discussionsRef","firebase","firestore","collection","doc","get","then","includes","catch","error","console","log","message","editVote","paddingLeft","paddingRight","payload","styles","container","profilecontainer","discussion_uid","textContainer","bottomRow","upvoteView","text","length","new_upvotes","splice","indexOf","update","num_upvotes","push","StyleSheet","create","backgroundColor","flexDirection","width","borderBottomWidth","borderBottomColor","paddingBottom","paddingTop","alignContent","horizontalContainer","alignItems","height","name","fontWeight","color","fontFamily","fontSize","justifyContent","borderRadius","marginRight","flex"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;AAGA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;AAEA,IAAMA,kBAAkB,GAAG,SAArBA,kBAAqB,OAQrB;AAAA,MAPJC,KAOI,QAPJA,KAOI;AAAA,MANJC,WAMI,QANJA,WAMI;AAAA,MALJC,IAKI,QALJA,IAKI;AAAA,MAJJC,EAII,QAJJA,EAII;AAAA,MAHJC,aAGI,QAHJA,aAGI;AAAA,MAFJC,YAEI,QAFJA,YAEI;AAAA,MADJC,OACI,QADJA,OACI;;AAAA,kBAC0B,qBAAS,KAAT,CAD1B;AAAA;AAAA,MACGC,OADH;AAAA,MACYC,UADZ;;AAAA,mBAE0B,qBAAS,EAAT,CAF1B;AAAA;AAAA,MAEGC,OAFH;AAAA,MAEYC,UAFZ;;AAGJ,MAAIC,QAAQ,GAAGL,OAAO,GAAG,EAAH,GAAQ,CAA9B;;AACA,WAAeM,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8CACoBC,sBAAaC,OAAb,CAAqB,OAArB,CADpB;;AAAA;AACQC,YAAAA,GADR;AAEQC,YAAAA,cAFR,GAEyBC,iBAASC,SAAT,GAAqBC,UAArB,CAAgC,aAAhC,CAFzB;AAGEH,YAAAA,cAAc,CACXI,GADH,CACOjB,EADP,EAEGkB,GAFH,GAGGC,IAHH,CAGQ,UAACF,GAAD,EAAS;AACb,kBAAMlB,IAAI,GAAGkB,GAAG,CAAClB,IAAJ,EAAb;AACAM,cAAAA,UAAU,CAACN,IAAI,CAACO,OAAL,CAAac,QAAb,CAAsBR,GAAtB,CAAD,CAAV;AACAL,cAAAA,UAAU,CAACR,IAAI,CAACO,OAAN,CAAV;AACD,aAPH,EAQGe,KARH,CAQS,UAACC,KAAD;AAAA,qBAAWC,OAAO,CAACC,GAAR,CAAYF,KAAK,CAACG,OAAlB,CAAX;AAAA,aART;;AAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAaA,wBAAU,YAAM;AACdhB,IAAAA,QAAQ;AACR,WAAO,YAAM;AACX;AACD,KAFD;AAGD,GALD,EAKG,EALH;AAMA,SACE,6BAAC,yBAAD;AACE,IAAA,OAAO,EAAE,mBAAM;AACb,mCAAS,gBAAT,EAA2B;AACzBV,QAAAA,IAAI,EAAEA,IADmB;AAEzBK,QAAAA,OAAO,EAAPA,OAFyB;AAGzBC,QAAAA,UAAU,EAAVA,UAHyB;AAIzBC,QAAAA,OAAO,EAAPA,OAJyB;AAKzBC,QAAAA,UAAU,EAAVA,UALyB;AAMzBmB,QAAAA,QAAQ,EAARA;AANyB,OAA3B;AAQD,KAVH;AAWE,IAAA,QAAQ,EAAEzB,aAXZ;AAYE,IAAA,KAAK,EAAE;AAAE0B,MAAAA,WAAW,EAAEnB,QAAf;AAAyBoB,MAAAA,YAAY,EAAEpB;AAAvC,KAZT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAcE,6BAAC,iCAAD;AAAkB,IAAA,WAAW,EAAE,qBAACqB,OAAD;AAAA,aAAapB,QAAQ,EAArB;AAAA,KAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAdF,EAeE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAEqB,MAAM,CAACC,SAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAED,MAAM,CAACE,gBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,oBAAD;AAAa,IAAA,GAAG,EAAEjC,IAAI,CAACkC,cAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,EAIE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAEH,MAAM,CAACI,aAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,yBAAD;AAAM,IAAA,KAAK,EAAEJ,MAAM,CAACjC,KAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA4BA,KAA5B,CADF,EAEE,6BAAC,yBAAD;AAAM,IAAA,KAAK,EAAEiC,MAAM,CAAChC,WAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAkCA,WAAlC,CAFF,EAGE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAEgC,MAAM,CAACK,SAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,iCAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,yBAAD;AACE,IAAA,OAAO,EAAE;AAAA,aAAMT,QAAQ,CAACpB,OAAD,EAAUN,EAAV,EAAcK,UAAd,CAAd;AAAA,KADX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAGE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAEyB,MAAM,CAACM,UAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,oBAAD;AACE,IAAA,IAAI,EAAEhC,OAAO,GAAG,OAAH,GAAa,SAD5B;AAEE,IAAA,IAAI,EAAE,EAFR;AAGE,IAAA,KAAK,EAAEA,OAAO,GAAG,SAAH,GAAe,SAH/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAME,6BAAC,yBAAD;AAAM,IAAA,KAAK,EAAE0B,MAAM,CAACO,IAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA2B/B,OAAO,CAACgC,MAAnC,CANF,CAHF,CADF,CADF,EAeE,6BAAC,aAAD;AAAM,IAAA,KAAK,EAAER,MAAM,CAACM,UAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,6BAAC,oBAAD;AAAM,IAAA,IAAI,EAAE,WAAZ;AAAyB,IAAA,IAAI,EAAE,EAA/B;AAAmC,IAAA,KAAK,EAAE,SAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,6BAAC,yBAAD;AAAM,IAAA,KAAK,EAAEN,MAAM,CAACO,IAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA2BnC,YAA3B,CAFF,CAfF,CAHF,CAJF,CAfF,CADF;AA+CD,CA9ED;;AAgFA,IAAMwB,QAAQ,GAAG,SAAXA,QAAW,CAAOpB,OAAP,EAAgBN,EAAhB,EAAoBK,UAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CACGK,sBAAaC,OAAb,CAAqB,OAArB,CADH;;AAAA;AACTC,UAAAA,GADS;AAETC,UAAAA,cAFS,GAEQC,iBAASC,SAAT,GAAqBC,UAArB,CAAgC,aAAhC,CAFR;AAGfO,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACIe,UAAAA,WAJW,GAIGjC,OAJH;;AAAA,eAKXA,OAAO,CAACc,QAAR,CAAiBR,GAAjB,CALW;AAAA;AAAA;AAAA;;AAMb2B,UAAAA,WAAW,CAACC,MAAZ,CAAmBD,WAAW,CAACE,OAAZ,CAAoB7B,GAApB,CAAnB,EAA6C,CAA7C;AANa;AAAA,4CAOPC,cAAc,CACjBI,GADG,CACCjB,EADD,EAEH0C,MAFG,CAEI;AAAEpC,YAAAA,OAAO,EAAEiC,WAAX;AAAwBI,YAAAA,WAAW,EAAErC,OAAO,CAACgC;AAA7C,WAFJ,CAPO;;AAAA;AAUbjC,UAAAA,UAAU,CAAC,KAAD,CAAV;AAVa;AAAA;;AAAA;AAabkC,UAAAA,WAAW,CAACK,IAAZ,CAAiBhC,GAAjB;AAba;AAAA,4CAcPC,cAAc,CACjBI,GADG,CACCjB,EADD,EAEH0C,MAFG,CAEI;AAAEpC,YAAAA,OAAO,EAAEiC,WAAX;AAAwBI,YAAAA,WAAW,EAAErC,OAAO,CAACgC;AAA7C,WAFJ,CAdO;;AAAA;AAiBbjC,UAAAA,UAAU,CAAC,IAAD,CAAV;;AAjBa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAjB;;AAqBA,IAAMyB,MAAM,GAAGe,oBAAWC,MAAX,CAAkB;AAC/Bf,EAAAA,SAAS,EAAE;AACTgB,IAAAA,eAAe,EAAE,OADR;AAETC,IAAAA,aAAa,EAAE,KAFN;AAGTC,IAAAA,KAAK,EAAE,MAHE;AAIT9C,IAAAA,OAAO,EAAE,CAJA;AAKT+C,IAAAA,iBAAiB,EAAE,CALV;AAMTC,IAAAA,iBAAiB,EAAE,SANV;AAOTC,IAAAA,aAAa,EAAE,EAPN;AAQTC,IAAAA,UAAU,EAAE;AARH,GADoB;AAW/BrB,EAAAA,gBAAgB,EAAE;AAChBgB,IAAAA,aAAa,EAAE,QADC;AAEhBM,IAAAA,YAAY,EAAE,YAFE;AAGhB1B,IAAAA,YAAY,EAAE;AAHE,GAXa;AAgB/B2B,EAAAA,mBAAmB,EAAE;AACnBP,IAAAA,aAAa,EAAE,aADI;AAEnBQ,IAAAA,UAAU,EAAE,QAFO;AAGnBC,IAAAA,MAAM,EAAE;AAHW,GAhBU;AAqB/BC,EAAAA,IAAI,EAAE;AACJC,IAAAA,UAAU,EAAE;AADR,GArByB;AAwB/BtB,EAAAA,IAAI,EAAE;AACJuB,IAAAA,KAAK,EAAE,SADH;AAEJC,IAAAA,UAAU,EAAE,SAFR;AAGJlC,IAAAA,WAAW,EAAE,CAHT;AAIJmC,IAAAA,QAAQ,EAAE;AAJN,GAxByB;AA8B/B1B,EAAAA,UAAU,EAAE;AACVY,IAAAA,aAAa,EAAE,KADL;AAEVQ,IAAAA,UAAU,EAAE,UAFF;AAGVO,IAAAA,cAAc,EAAE,YAHN;AAIVV,IAAAA,UAAU,EAAE,CAJF;AAOVW,IAAAA,YAAY,EAAE,CAPJ;AAQVC,IAAAA,WAAW,EAAE;AARH,GA9BmB;AAwC/BpE,EAAAA,KAAK,EAAE;AACLgE,IAAAA,UAAU,EAAE,cADP;AAELC,IAAAA,QAAQ,EAAE,EAFL;AAGLT,IAAAA,UAAU,EAAE,CAHP;AAILD,IAAAA,aAAa,EAAE;AAJV,GAxCwB;AA8C/BtD,EAAAA,WAAW,EAAE;AACX+D,IAAAA,UAAU,EAAE,iBADD;AAEXC,IAAAA,QAAQ,EAAE,EAFC;AAGXF,IAAAA,KAAK,EAAE;AAHI,GA9CkB;AAmD/BzB,EAAAA,SAAS,EAAE;AACThC,IAAAA,OAAO,EAAE,CADA;AAET6C,IAAAA,aAAa,EAAE;AAFN,GAnDoB;AAuD/Bd,EAAAA,aAAa,EAAE;AACbgC,IAAAA,IAAI,EAAE;AADO;AAvDgB,CAAlB,CAAf;;eA2DetE,kB","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\nimport { firebase } from \"../firebase/config.js\";\nimport { View, TouchableOpacity, TouchableWithoutFeedback } from \"react-native\";\nimport { StyleSheet, ImageBackground } from \"react-native\";\nimport { Text, Image } from \"react-native-elements\";\nimport Spacer from \"./Spacer\";\nimport { navigate } from \"../navigationRef\";\nimport Icon from \"react-native-vector-icons/FontAwesome\";\nimport ProfileIcon from \"./ProfileIcon\";\nimport { NavigationEvents } from \"react-navigation\";\n\nconst DiscussionFeedView = ({\n  title,\n  description,\n  data,\n  id,\n  not_touchable,\n  num_comments,\n  padding,\n}) => {\n  const [upvoted, setUpvoted] = useState(false);\n  const [upvotes, setUpvotes] = useState([]);\n  let padding_ = padding ? 16 : 0;\n  async function fetchUid() {\n    const uid = await AsyncStorage.getItem(\"token\");\n    const discussionsRef = firebase.firestore().collection(\"discussions\");\n    discussionsRef\n      .doc(id)\n      .get()\n      .then((doc) => {\n        const data = doc.data();\n        setUpvoted(data.upvotes.includes(uid));\n        setUpvotes(data.upvotes);\n      })\n      .catch((error) => console.log(error.message));\n  }\n  useEffect(() => {\n    fetchUid();\n    return () => {\n      null;\n    };\n  }, []);\n  return (\n    <TouchableOpacity\n      onPress={() => {\n        navigate(\"DiscussionView\", {\n          data: data,\n          upvoted,\n          setUpvoted,\n          upvotes,\n          setUpvotes,\n          editVote,\n        });\n      }}\n      disabled={not_touchable}\n      style={{ paddingLeft: padding_, paddingRight: padding_ }}\n    >\n      <NavigationEvents onWillFocus={(payload) => fetchUid()} />\n      <View style={styles.container}>\n        <View style={styles.profilecontainer}>\n          <ProfileIcon uid={data.discussion_uid} />\n        </View>\n        <View style={styles.textContainer}>\n          <Text style={styles.title}>{title}</Text>\n          <Text style={styles.description}>{description}</Text>\n          <View style={styles.bottomRow}>\n            <TouchableWithoutFeedback>\n              <TouchableOpacity\n                onPress={() => editVote(upvotes, id, setUpvoted)}\n              >\n                <View style={styles.upvoteView}>\n                  <Icon\n                    name={upvoted ? \"heart\" : \"heart-o\"}\n                    size={20}\n                    color={upvoted ? \"#FFD770\" : \"#999999\"}\n                  />\n                  <Text style={styles.text}>{upvotes.length}</Text>\n                </View>\n              </TouchableOpacity>\n            </TouchableWithoutFeedback>\n            <View style={styles.upvoteView}>\n              <Icon name={\"comment-o\"} size={20} color={\"#999999\"} />\n              <Text style={styles.text}>{num_comments}</Text>\n            </View>\n          </View>\n        </View>\n      </View>\n    </TouchableOpacity>\n  );\n};\n\nconst editVote = async (upvotes, id, setUpvoted) => {\n  const uid = await AsyncStorage.getItem(\"token\");\n  const discussionsRef = firebase.firestore().collection(\"discussions\");\n  console.log(\"hi\");\n  let new_upvotes = upvotes;\n  if (upvotes.includes(uid)) {\n    new_upvotes.splice(new_upvotes.indexOf(uid), 1);\n    await discussionsRef\n      .doc(id)\n      .update({ upvotes: new_upvotes, num_upvotes: upvotes.length });\n    setUpvoted(false);\n  } else {\n    // discussion has not already been upvoted\n    new_upvotes.push(uid);\n    await discussionsRef\n      .doc(id)\n      .update({ upvotes: new_upvotes, num_upvotes: upvotes.length });\n    setUpvoted(true);\n  }\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    backgroundColor: \"white\",\n    flexDirection: \"row\",\n    width: \"100%\",\n    padding: 0,\n    borderBottomWidth: 2,\n    borderBottomColor: \"#E5E5E5\",\n    paddingBottom: 16,\n    paddingTop: 16,\n  },\n  profilecontainer: {\n    flexDirection: \"column\",\n    alignContent: \"flex-start\",\n    paddingRight: 8,\n  },\n  horizontalContainer: {\n    flexDirection: \"row-reverse\",\n    alignItems: \"center\",\n    height: \"100%\",\n  },\n  name: {\n    fontWeight: \"bold\",\n  },\n  text: {\n    color: \"#999999\",\n    fontFamily: \"Raleway\",\n    paddingLeft: 4,\n    fontSize: 11,\n  },\n  upvoteView: {\n    flexDirection: \"row\",\n    alignItems: \"flex-end\",\n    justifyContent: \"flex-start\",\n    paddingTop: 8,\n    // borderColor: \"#FFD770\",\n    // borderWidth: 1,\n    borderRadius: 8,\n    marginRight: 8,\n  },\n  title: {\n    fontFamily: \"Raleway-Bold\",\n    fontSize: 13,\n    paddingTop: 6,\n    paddingBottom: 8,\n  },\n  description: {\n    fontFamily: \"Raleway-Regular\",\n    fontSize: 13,\n    color: \"#86878B\",\n  },\n  bottomRow: {\n    padding: 0,\n    flexDirection: \"row\",\n  },\n  textContainer: {\n    flex: 1,\n  },\n});\nexport default DiscussionFeedView;\n"]},"metadata":{},"sourceType":"script"}